/**
 * cbpGridGallery.js v1.0.0
 * http://www.codrops.com
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 * 
 * Copyright 2014, Codrops
 * http://www.codrops.com
 */
!function(window){"use strict";function setTransform(el,transformStr){el.style.WebkitTransform=transformStr,el.style.msTransform=transformStr,el.style.transform=transformStr}function getViewportW(){var client=docElem.clientWidth,inner=window.innerWidth;return client<inner?inner:client}function extend(a,b){for(var key in b)b.hasOwnProperty(key)&&(a[key]=b[key]);return a}function CBPGridGallery(el,options){this.el=el,this.options=extend({},this.options),extend(this.options,options),this._init()}var docElem=window.document.documentElement,transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},transEndEventName=transEndEventNames[Modernizr.prefixed("transition")],support={transitions:Modernizr.csstransitions,support3d:Modernizr.csstransforms3d};CBPGridGallery.prototype.options={},CBPGridGallery.prototype._init=function(){this.grid=this.el.querySelector("section.grid-wrap > ul.grid"),this.gridItems=[].slice.call(this.grid.querySelectorAll("li:not(.grid-sizer)")),this.itemsCount=this.gridItems.length,this.slideshow=this.el.querySelector("section.slideshow > ul"),this.slideshowItems=[].slice.call(this.slideshow.children),this.current=-1,this.ctrlPrev=this.el.querySelector("section.slideshow > nav > span.nav-prev"),this.ctrlNext=this.el.querySelector("section.slideshow > nav > span.nav-next"),this.ctrlClose=this.el.querySelector("section.slideshow > nav > span.nav-close"),this._initMasonry(),this._initEvents()},CBPGridGallery.prototype._initMasonry=function(){var grid=this.grid;imagesLoaded(grid,function(){new Masonry(grid,{itemSelector:"li",columnWidth:grid.querySelector(".grid-sizer")})})},CBPGridGallery.prototype._initEvents=function(){var self=this;this.gridItems.forEach(function(item,idx){item.addEventListener("click",function(){self._openSlideshow(idx)})}),this.ctrlPrev.addEventListener("click",function(){self._navigate("prev")}),this.ctrlNext.addEventListener("click",function(){self._navigate("next")}),this.ctrlClose.addEventListener("click",function(){self._closeSlideshow()}),window.addEventListener("resize",function(){self._resizeHandler()}),document.addEventListener("keydown",function(ev){if(self.isSlideshowVisible){var keyCode=ev.keyCode||ev.which;switch(keyCode){case 37:self._navigate("prev");break;case 39:self._navigate("next");break;case 27:self._closeSlideshow()}}}),window.addEventListener("scroll",function(){self.isSlideshowVisible?window.scrollTo(self.scrollPosition?self.scrollPosition.x:0,self.scrollPosition?self.scrollPosition.y:0):self.scrollPosition={x:window.pageXOffset||docElem.scrollLeft,y:window.pageYOffset||docElem.scrollTop}})},CBPGridGallery.prototype._openSlideshow=function(pos){if(this.isSlideshowVisible=!0,this.current=pos,classie.addClass(this.el,"slideshow-open"),this._setViewportItems(),classie.addClass(this.currentItem,"current"),classie.addClass(this.currentItem,"show"),this.prevItem){classie.addClass(this.prevItem,"show");var translateVal=+(-1*(getViewportW()/2+this.prevItem.offsetWidth/2));setTransform(this.prevItem,support.support3d?"translate3d("+translateVal+"px, 0, -150px)":"translate("+translateVal+"px)")}if(this.nextItem){classie.addClass(this.nextItem,"show");var translateVal=+(getViewportW()/2+this.nextItem.offsetWidth/2);setTransform(this.nextItem,support.support3d?"translate3d("+translateVal+"px, 0, -150px)":"translate("+translateVal+"px)")}},CBPGridGallery.prototype._navigate=function(dir){if(!this.isAnimating){if("next"===dir&&this.current===this.itemsCount-1||"prev"===dir&&0===this.current)return void this._closeSlideshow();this.isAnimating=!0,this._setViewportItems();var transformOutStr,transformIncomingStr,incomingItem,self=this,itemWidth=this.currentItem.offsetWidth,transformLeftStr=support.support3d?"translate3d(-"+ +(getViewportW()/2+itemWidth/2)+"px, 0, -150px)":"translate(-"+ +(getViewportW()/2+itemWidth/2)+"px)",transformRightStr=support.support3d?"translate3d("+ +(getViewportW()/2+itemWidth/2)+"px, 0, -150px)":"translate("+ +(getViewportW()/2+itemWidth/2)+"px)",transformCenterStr="";"next"===dir?(transformOutStr=support.support3d?"translate3d( -"+ +(2*getViewportW()/2+itemWidth/2)+"px, 0, -150px )":"translate(-"+ +(2*getViewportW()/2+itemWidth/2)+"px)",transformIncomingStr=support.support3d?"translate3d( "+ +(2*getViewportW()/2+itemWidth/2)+"px, 0, -150px )":"translate("+ +(2*getViewportW()/2+itemWidth/2)+"px)"):(transformOutStr=support.support3d?"translate3d( "+ +(2*getViewportW()/2+itemWidth/2)+"px, 0, -150px )":"translate("+ +(2*getViewportW()/2+itemWidth/2)+"px)",transformIncomingStr=support.support3d?"translate3d( -"+ +(2*getViewportW()/2+itemWidth/2)+"px, 0, -150px )":"translate(-"+ +(2*getViewportW()/2+itemWidth/2)+"px)"),classie.removeClass(self.slideshow,"animatable"),("next"===dir&&this.current<this.itemsCount-2||"prev"===dir&&this.current>1)&&(incomingItem=this.slideshowItems["next"===dir?this.current+2:this.current-2],setTransform(incomingItem,transformIncomingStr),classie.addClass(incomingItem,"show"));var slide=function(){classie.addClass(self.slideshow,"animatable"),classie.removeClass(self.currentItem,"current");var nextCurrent="next"===dir?self.nextItem:self.prevItem;classie.addClass(nextCurrent,"current"),setTransform(self.currentItem,"next"===dir?transformLeftStr:transformRightStr),self.nextItem&&setTransform(self.nextItem,"next"===dir?transformCenterStr:transformOutStr),self.prevItem&&setTransform(self.prevItem,"next"===dir?transformOutStr:transformCenterStr),incomingItem&&setTransform(incomingItem,"next"===dir?transformRightStr:transformLeftStr);var onEndTransitionFn=function(ev){if(support.transitions){if(ev.propertyName.indexOf("transform")===-1)return!1;this.removeEventListener(transEndEventName,onEndTransitionFn)}self.prevItem&&"next"===dir?classie.removeClass(self.prevItem,"show"):self.nextItem&&"prev"===dir&&classie.removeClass(self.nextItem,"show"),"next"===dir?(self.prevItem=self.currentItem,self.currentItem=self.nextItem,incomingItem&&(self.nextItem=incomingItem)):(self.nextItem=self.currentItem,self.currentItem=self.prevItem,incomingItem&&(self.prevItem=incomingItem)),self.current="next"===dir?self.current+1:self.current-1,self.isAnimating=!1};support.transitions?self.currentItem.addEventListener(transEndEventName,onEndTransitionFn):onEndTransitionFn()};setTimeout(slide,25)}},CBPGridGallery.prototype._closeSlideshow=function(){classie.removeClass(this.el,"slideshow-open"),classie.removeClass(this.slideshow,"animatable");var self=this,onEndTransitionFn=function(ev){if(support.transitions){if("ul"!==ev.target.tagName.toLowerCase())return;this.removeEventListener(transEndEventName,onEndTransitionFn)}classie.removeClass(self.currentItem,"current"),classie.removeClass(self.currentItem,"show"),self.prevItem&&classie.removeClass(self.prevItem,"show"),self.nextItem&&classie.removeClass(self.nextItem,"show"),self.slideshowItems.forEach(function(item){setTransform(item,"")}),self.isSlideshowVisible=!1};support.transitions?this.el.addEventListener(transEndEventName,onEndTransitionFn):onEndTransitionFn()},CBPGridGallery.prototype._setViewportItems=function(){this.currentItem=null,this.prevItem=null,this.nextItem=null,this.current>0&&(this.prevItem=this.slideshowItems[this.current-1]),this.current<this.itemsCount-1&&(this.nextItem=this.slideshowItems[this.current+1]),this.currentItem=this.slideshowItems[this.current]},CBPGridGallery.prototype._resizeHandler=function(){function delayed(){self._resize(),self._resizeTimeout=null}var self=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(delayed,50)},CBPGridGallery.prototype._resize=function(){if(this.isSlideshowVisible){if(this.prevItem){var translateVal=+(-1*(getViewportW()/2+this.prevItem.offsetWidth/2));setTransform(this.prevItem,support.support3d?"translate3d("+translateVal+"px, 0, -150px)":"translate("+translateVal+"px)")}if(this.nextItem){var translateVal=+(getViewportW()/2+this.nextItem.offsetWidth/2);setTransform(this.nextItem,support.support3d?"translate3d("+translateVal+"px, 0, -150px)":"translate("+translateVal+"px)")}}},window.CBPGridGallery=CBPGridGallery}(window);